names(ipca_categorias_melted$variable) <- id_categoria
names(ipca_categorias_melted$variable) <- 'id_categoria'
ipca_categorias_melted
colnames(ipca_categorias_melted) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted
setDT(ipca_categorias)
ipca_categorias[.variacao_acumulada = ipca_categorias_melted[value %in% id_categoria, unique(id_categoria)]), on = 'id_categoria']
ipca_categorias[.(variacao_doze_meses = ipca_categorias_melted[value %in% id_categoria, unique(id_categoria)]), on = 'id_categoria']
ipca_categorias_melted
ipca_categorias_melted1 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted1$id_categoria['1']
ipca_categorias_melted1$id_categoria$1
ipca_categorias_melted1
ipca_categorias_melted
unique(ipca_categorias_melted1$id_categoria)
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted$id_categoria))
ipca_categorias_melted$id_categoria
unique(ipca_categorias_melted$id_categoria)
list(unique(ipca_categorias_melted$id_categoria))
c(unique(ipca_categorias_melted$id_categoria))
unique(ipca_categorias_melted1$id_categoria)
setDT(ipca_categorias_complemento)
ipca_categorias_melted <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
# Há um número de categorias menor na IPCA a partir de 2020
ipca_categorias_melted1 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
setDT(ipca_categorias_complemento)
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
unique(ipca_categorias_melted1$id_categoria)
setDT(ipca_categorias_complemento)
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
unique(ipca_categorias_melted1$id_categoria)
colnames(ipca_categorias_melted) <- c('ano','mes','id_categoria','value')
unique(ipca_categorias_melted1$id_categoria)
colnames(ipca_categorias_melted) <- c('ano','mes','id_categoria','value')
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
unique(ipca_categorias_melted1$id_categoria)
# Há um número de categorias menor na IPCA a partir de 2020
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
unique(ipca_categorias_melted1$id_categoria)
setDT(ipca_categorias_melted2)
ipca_categorias_melted2 <- melt(ipca_categorias_melted2,id.vars=(c('ano','mes')))
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
unique(ipca_categorias_melted1$id_categoria)
colnames(ipca_categorias_melted2) <- c('ano','mes','id_categoria','value')
unique(ipca_categorias_melted2$id_categoria)
ipca_categorias_melted2
ipca_categorias_melted2 <- melt(ipca_categorias_melted2,
id.vars= c('ano','mes'),
measure.vars = 'variacao_doze_meses')
colnames(ipca_categorias_melted2) <- c('ano','mes','id_categoria','value')
# Há um número de categorias menor na IPCA a partir de 2020
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
setDT(ipca_categorias_melted2)
ipca_categorias_melted2 <- melt(ipca_categorias_melted2,
id.vars= c('ano','mes'),
measure.vars = 'variacao_doze_meses')
ipca_categorias_melted2
ipca_categorias_melted2
# Há um número de categorias menor na IPCA a partir de 2020
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
ipca_categorias_melted1
# Criando um tibble que possui os valores falantes do IPCA acumulado em 12 meses
ipca_categorias_complemento <- df_ipca_categorias_complemento %>%
mutate(across(!data, ~(as.numeric(.)/100)+1)) %>%
mutate(across(!data, ~ round((RcppRoll::roll_prodr(., n = 12, na.rm = T, fill = 1.04)-1)*100,2))) %>%
select(!data) %>%
slice(13:(n()-1)) %>%
mutate(ano = 2020) %>%
mutate(mes = 1:11) %>%
dplyr::select(ano,mes,everything())
setDT(ipca_categorias_complemento)
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
# Há um número de categorias menor na IPCA a partir de 2020
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
# Há um número de categorias menor na IPCA a partir de 2020
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted2 <- ipca_categorias_melted2 %>%
filter(id_categoria != '7203')
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
# Há um número de categorias menor na IPCA a partir de 2020
nrow(ipca_categorias_melted1)
nrow(ipca_categorias_melted2)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted2 <- ipca_categorias_melted2 %>%
filter(id_categoria != '7203')
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
# Há um número de categorias menor na IPCA a partir de 2020
ncol(ipca_categorias_melted1)
ncol(ipca_categorias_melted2)
# Há um número de categorias menor na IPCA a partir de 2020
nrow(unique(ipca_categorias_melted1$id_categoria))
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
ncol(ipca_categorias_melted2)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted2 <- ipca_categorias_melted2 %>%
filter(id_categoria == '7203')
ipca_categorias_melted2
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2 %>%
filter(id_categoria == '7203')
ipca_categorias_melted2 %>%
filter(id_categoria == 7203)
ipca_categorias_melted2
# IPCA de categorias
ipca_categorias <- df_ipca_categorias %>%
select(!c(id_categoria_bd,variacao_anual)) %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
# Filtrando somente até ítens do IPCA
filter(id_categoria < 10000) %>%
group_by(id_categoria) %>%
mutate(variacao_acumulada = (cumprod(1+(variacao_mensal/100))-1)*100,2) %>%
arrange(id_categoria)
ipca_categorias
# Criando um dataframe vazio e combinando ele com o complemento
empty_df <- data.frame(matrix(data = 0.5, nrow = nrow(ipca_categorias_complemento), ncol = ncol(ipca_categorias_complemento)))
colnames(empty_df) <- colnames(ipca_categorias_complemento)
df_ipca_categorias_complemento <-rbind(ipca_categorias_complemento,empty_df)
# Criando um tibble que possui os valores falantes do IPCA acumulado em 12 meses
ipca_categorias_complemento <- df_ipca_categorias_complemento %>%
mutate(across(!data, ~(as.numeric(.)/100)+1)) %>%
mutate(across(!data, ~ round((RcppRoll::roll_prodr(., n = 12, na.rm = T, fill = 1.04)-1)*100,2))) %>%
select(!data) %>%
slice(13:(n()-1)) %>%
mutate(ano = 2020) %>%
mutate(mes = 1:11) %>%
dplyr::select(ano,mes,everything())
icpa_categorias_complemento
icpa_categorias_complemento
# Criando um dataframe vazio e combinando ele com o complemento
empty_df <- data.frame(matrix(data = 0.5, nrow = nrow(ipca_categorias_complemento), ncol = ncol(ipca_categorias_complemento)))
colnames(empty_df) <- colnames(ipca_categorias_complemento)
df_ipca_categorias_complemento <-bind_rows(ipca_categorias_complemento,empty_df)
icpa_categorias_complemento
df+icpa_categorias_complemento
df_icpa_categorias_complemento
df_ipca_categorias_complemento
# Complementação do IPCA de categorias
ipca_categorias_complemento <- read_excel('data/IPCA_categorias.xlsx',col_names = T)
# Reajuste dos nomes das colunas para combinar com o id_categoria
colnames(ipca_categorias_complemento) <- c('data',gsub("[^0-9]", "", colnames(ipca_categorias_complemento)[2:81]))
# IPCA cheio
ipca_cheio <- df_ipca_cheio %>%
select(!c(indice,variacao_trimestral,variacao_semestral,variacao_anual)) %>%
filter(ano >= 2000)
ipca_cheio
# IPCA de categorias
ipca_categorias <- df_ipca_categorias %>%
select(!c(id_categoria_bd,variacao_anual)) %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
# Filtrando somente até ítens do IPCA
filter(id_categoria < 10000) %>%
group_by(id_categoria) %>%
mutate(variacao_acumulada = (cumprod(1+(variacao_mensal/100))-1)*100,2) %>%
arrange(id_categoria)
ipca_categorias
# Criando um dataframe vazio e combinando ele com o complemento
empty_df <- data.frame(matrix(data = 0.5, nrow = nrow(ipca_categorias_complemento), ncol = ncol(ipca_categorias_complemento)))
colnames(empty_df) <- colnames(ipca_categorias_complemento)
df_ipca_categorias_complemento <- bind_rows(ipca_categorias_complemento,empty_df)
df_ipca_categorias_complemento
empty_df
df_ipca_categorias_complemento <- rbind(ipca_categorias_complemento,empty_df)
df_ipca_categorias_complemento
# IPCA cheio
ipca_cheio <- df_ipca_cheio %>%
select(!c(indice,variacao_trimestral,variacao_semestral,variacao_anual)) %>%
filter(ano >= 2000)
ipca_cheio
# IPCA de categorias
ipca_categorias <- df_ipca_categorias %>%
select(!c(id_categoria_bd,variacao_anual)) %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
# Filtrando somente até ítens do IPCA
filter(id_categoria < 10000) %>%
group_by(id_categoria) %>%
mutate(variacao_acumulada = (cumprod(1+(variacao_mensal/100))-1)*100,2) %>%
arrange(id_categoria)
ipca_categorias
# Criando um dataframe vazio e combinando ele com o complemento
empty_df <- data.frame(matrix(data = 0.5, nrow = nrow(ipca_categorias_complemento), ncol = ncol(ipca_categorias_complemento)))
colnames(empty_df) <- colnames(ipca_categorias_complemento)
df_ipca_categorias_complemento <- rbind(ipca_categorias_complemento,empty_df)
df_ipca_categorias_complemento
# Criando um tibble que possui os valores falantes do IPCA acumulado em 12 meses
ipca_categorias_complemento <- df_ipca_categorias_complemento %>%
mutate(across(!data, ~(as.numeric(.)/100)+1)) %>%
mutate(across(!data, ~ round((RcppRoll::roll_prodr(., n = 12, na.rm = T, fill = 1.04)-1)*100,2))) %>%
select(!data) %>%
slice(13:(n()-1)) %>%
mutate(ano = 2020) %>%
mutate(mes = 1:11) %>%
dplyr::select(ano,mes,everything())
setDT(ipca_categorias_complemento)
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
str(ipca_categorias_melted1$id_categoria)
ipca_categorias_complemento
# Criando um tibble que possui os valores falantes do IPCA acumulado em 12 meses
ipca_categorias_complemento <- df_ipca_categorias_complemento %>%
mutate(across(!data, ~(as.numeric(.)/100)+1)) %>%
mutate(across(!data, ~ round((RcppRoll::roll_prodr(., n = 12, na.rm = T, fill = 1.04)-1)*100,2))) %>%
select(!data) %>%
slice(13:(n()-1)) %>%
mutate(ano = 2020) %>%
mutate(mes = 1:11) %>%
dplyr::select(ano,mes,everything())
ipca_categorias_complemento
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted2 %>%
filter(id_categoria == 7203)
ipca_categorias_melted2 %>%
filter(id_categoria == '7203')
ipca_categorias_melted2
ipca_categorias_melted2 <- tibble(ipca_categorias_melted2) %>%
filter(id_categoria == 7203)
ipca_categorias_melted2
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted2
ipca_categorias_melted2 <- tibble(ipca_categorias_melted2) %>%
filter(id_categoria == 7203)
ipca_categorias_melted2
tibble(ipca_categorias_melted2) %>%
filter(id_categoria == 7203)
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
# Complementação do IPCA de categorias
ipca_categorias_complemento <- read_excel('data/IPCA_categorias.xlsx',col_names = T)
# Reajuste dos nomes das colunas para combinar com o id_categoria
colnames(ipca_categorias_complemento) <- c('data',gsub("[^0-9]", "", colnames(ipca_categorias_complemento)[2:81]))
# IPCA cheio
ipca_cheio <- df_ipca_cheio %>%
select(!c(indice,variacao_trimestral,variacao_semestral,variacao_anual)) %>%
filter(ano >= 2000)
ipca_cheio
# IPCA de categorias
ipca_categorias <- df_ipca_categorias %>%
select(!c(id_categoria_bd,variacao_anual)) %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
# Filtrando somente até ítens do IPCA
filter(id_categoria < 10000) %>%
group_by(id_categoria) %>%
mutate(variacao_acumulada = (cumprod(1+(variacao_mensal/100))-1)*100,2) %>%
arrange(id_categoria)
ipca_categorias
# Criando um dataframe vazio e combinando ele com o complemento
empty_df <- data.frame(matrix(data = 0.5, nrow = nrow(ipca_categorias_complemento), ncol = ncol(ipca_categorias_complemento)))
colnames(empty_df) <- colnames(ipca_categorias_complemento)
df_ipca_categorias_complemento <- rbind(ipca_categorias_complemento,empty_df)
df_ipca_categorias_complemento
# Criando um tibble que possui os valores falantes do IPCA acumulado em 12 meses
ipca_categorias_complemento <- df_ipca_categorias_complemento %>%
mutate(across(!data, ~(as.numeric(.)/100)+1)) %>%
mutate(across(!data, ~ round((RcppRoll::roll_prodr(., n = 12, na.rm = T, fill = 1.04)-1)*100,2))) %>%
select(!data) %>%
slice(13:(n()-1)) %>%
mutate(ano = 2020) %>%
mutate(mes = 1:11) %>%
dplyr::select(ano,mes,everything())
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
tibble(ipca_categorias_melted1) %>%
filter(id_categoria == 7203)
tibble(ipca_categorias_melted1) %>%
filter(id_categoria != 7203)
ipca_categorias_melted1 <- ipca_categorias_melted1 %>%
filter(id_categoria != 7203)
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_12 <- rbind(ipca_categorias_melted1,ipca_categorias_melted2)
glimpse(ipca_categorias_melted1)
glimpse(ipca_categorias_melted2)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
dplyr::rename(value = variacao_doze_meses)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
dplyr::rename(value = variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted1 <- ipca_categorias_melted1 %>%
filter(id_categoria != 7203)
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
glimpse(ipca_categorias_melted1)
glimpse(ipca_categorias_melted2)
ipca_categorias_12 <- rbind(ipca_categorias_melted1,ipca_categorias_melted2)
ipca_categorias_12
ipca_categorias %>%
select(!variacao_doze_meses)
ipca_categorias_full <- ipca_categorias %>%
select(!variacao_doze_meses)
ipca_categorias_12 %>%
arrange(id_categoria)
ipca_categorias_full <- ipca_categorias %>%
select(!variacao_doze_meses) %>%
add_column(ipca_categorias_12$value, .name_repair = 'variacao_doze_meses')
ipca_categorias_full <- ipca_categorias %>%
add_column(ipca_categorias_12$value)
ipca_categorias_full
ipca_categorias_12$value
ipca_categorias_full[ipca_categorias_12, on = c('ano','mes'), variacao_doze_meses := i.value ]
ipca_categorias_full[ipca_categorias_12, nomatch = 0 ]
ipca_categorias_full <- ipca_categorias
ipca_categorias_full[ipca_categorias_12, nomatch = 0 ]
ipca_categorias_full <- ipca_categorias %>%
arrange(id_categoria)
ipca_categorias_12 %>%
arrange(id_categoria)
ipca_categorias_full <- ipca_categorias %>%
arrange(id_categoria)
ipca_categorias_full[ipca_categorias_12, nomatch = 0 ]
ipca_categorias_full[ipca_categorias_12, all.x = T ]
ipca_categorias_full[ipca_categorias_12, on = 'id_categoria' ]
# Carregando pacotes
#### Carregando pacotes ####
library(basedosdados)
library(xts) # Objeto xts
library(zoo)
library(cowplot)
library(scales)
library(RColorBrewer)
library(dplyr)
library(tidyr)
library(tibble)
library(ggplot2)
library(knitr)
library(stargazer)
library(broom)
library(RcppRoll)
library(plotly)
library(here)
library(stringr)
library(readxl)
library(purrr)
library(data.table)
ipca_categorias_full[ipca_categorias_12, on = 'id_categoria' ]
View(ipca_categorias_full)
View(ipca_categorias_full)
# Complementação do IPCA de categorias
ipca_categorias_complemento <- read_excel('data/IPCA_categorias.xlsx',col_names = T)
# Reajuste dos nomes das colunas para combinar com o id_categoria
colnames(ipca_categorias_complemento) <- c('data',gsub("[^0-9]", "", colnames(ipca_categorias_complemento)[2:81]))
# IPCA cheio
ipca_cheio <- df_ipca_cheio %>%
select(!c(indice,variacao_trimestral,variacao_semestral,variacao_anual)) %>%
filter(ano >= 2000)
ipca_cheio
# IPCA de categorias
ipca_categorias <- df_ipca_categorias %>%
select(!c(id_categoria_bd,variacao_anual)) %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
# Filtrando somente até ítens do IPCA
filter(id_categoria < 10000) %>%
group_by(id_categoria) %>%
mutate(variacao_acumulada = (cumprod(1+(variacao_mensal/100))-1)*100,2) %>%
arrange(id_categoria)
ipca_categorias
# Criando um dataframe vazio e combinando ele com o complemento
empty_df <- data.frame(matrix(data = 0.5, nrow = nrow(ipca_categorias_complemento), ncol = ncol(ipca_categorias_complemento)))
colnames(empty_df) <- colnames(ipca_categorias_complemento)
df_ipca_categorias_complemento <- rbind(ipca_categorias_complemento,empty_df)
df_ipca_categorias_complemento
# Criando um tibble que possui os valores falantes do IPCA acumulado em 12 meses
ipca_categorias_complemento <- df_ipca_categorias_complemento %>%
mutate(across(!data, ~(as.numeric(.)/100)+1)) %>%
mutate(across(!data, ~ round((RcppRoll::roll_prodr(., n = 12, na.rm = T, fill = 1.04)-1)*100,2))) %>%
select(!data) %>%
slice(13:(n()-1)) %>%
mutate(ano = 2020) %>%
mutate(mes = 1:11) %>%
dplyr::select(ano,mes,everything())
ipca_categorias_melted1 <- melt(ipca_categorias_complemento,id.vars=(c('ano','mes')))
colnames(ipca_categorias_melted1) <- c('ano','mes','id_categoria','value')
ipca_categorias_melted1
unique(ipca_categorias_melted1$id_categoria)
ipca_categorias_melted2 <-ipca_categorias %>%
select(ano,mes,id_categoria,variacao_doze_meses) %>%
dplyr::rename(value = variacao_doze_meses) %>%
drop_na()
ipca_categorias_melted2
# Há um número de categorias menor na IPCA a partir de 2020
length(unique(ipca_categorias_melted1$id_categoria))
length(unique(ipca_categorias_melted2$id_categoria))
# Identificando qual grupo
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
ipca_categorias_melted1 <- ipca_categorias_melted1 %>%
filter(id_categoria != 7203)
setdiff(unique(ipca_categorias_melted1$id_categoria),unique(ipca_categorias_melted2$id_categoria))
glimpse(ipca_categorias_melted1)
glimpse(ipca_categorias_melted2)
ipca_categorias_12 <- rbind(ipca_categorias_melted1,ipca_categorias_melted2)
View(ipca_categorias_12)
View(ipca_categorias_12)
ipca_categorias_12 %>%
arrange(id_categoria)
ipca_categorias_12 <- ipca_categorias_12 %>%
arrange(id_categoria)
ipca_categorias_12 <- ipca_categorias_12 %>%
mutate(id_categoria = as.numeric(id_categoria))
ipca_categorias_12 <- ipca_categorias_12 %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
arrange(id_categoria)
ipca_categorias_12 <- rbind(ipca_categorias_melted1,ipca_categorias_melted2)
ipca_categorias_12 <- ipca_categorias_12 %>%
mutate(id_categoria = as.numeric(id_categoria)) %>%
arrange(id_categoria)
ipca_categorias_full <- ipca_categorias %>%
arrange(id_categoria)
ipca_categorias_full[ipca_categorias_12, on = 'id_categoria' ]
ipca_categorias_full[ipca_categorias_12, on = 'id_categoria' ]
ipca_categorias_full[ipca_categorias_12, on = .id_categoria ]
setDT(ipca_categorias_12)
setDT(ipca_categorias_full)
ipca_categorias_full[ipca_categorias_12, on = .id_categoria ]
class(ipca_categorias_12)
class(ipca_categorias_full)
ipca_categorias_full[ipca_categorias_12, on = .id_categoria ]
ipca_categorias_full[ipca_categorias_12, on = id_categoria ]
ipca_categorias_full[ipca_categorias_12, on = 'id_categoria' ]
ipca_categorias$variacao_doze_meses <- ipca_categorias_12$value
ipca_categorias
View(ipca_categorias)
View(ipca_categorias)
